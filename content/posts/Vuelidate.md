---
title: "Vuelidateâ€”â€”Vue.js 2.0è¡¨å•éªŒè¯å·¥å…·"
date: "2019-12-18T20:30:00+08:00"
tags: ["Vue.js"]
discripion: "ä¸€æ¬¾åŸºäº Vue.js2.0çš„è¡¨å•éªŒè¯å·¥å…· Vuelidate ä½¿ç”¨æ–¹æ³•æ€»ç»“"
keywords: ["Vue è¡¨è¾¾éªŒè¯", "Vuelidate"]
categories: ["Tech"]
toc: false
dropCap: false
comments: true
---
## å‰è¨€
[Vuelidate](https://vuelidate.js.org/) æ˜¯ [Vue.js 2.0](https://cn.vuejs.org/) çš„ä¸€æ¬¾è¡¨å•éªŒè¯å·¥å…·ï¼Œé¦–å…ˆè¦è¡¨æ˜çš„æ˜¯é€‰æ‹©å…¶æ¥åšè¡¨å•éªŒè¯å¹¶æ˜¯å› ä¸ºå…¶ç›¸æ¯”äºå…¶å®ƒ Vue è¡¨å•éªŒè¯å·¥å…·æœ‰å¤šä¹ˆä¼˜ç§€ï¼Œè€Œæ˜¯å› ä¸ºé¡¹ç›®ç”¨åˆ°äº†ä¸€æ¬¾åŸºäº [Material Design](https://material.io/) é£æ ¼çš„ UI æ¡†æ¶ [Vuetify](https://vuetifyjs.com/en/)ï¼Œæ­¤ UI æ¡†æ¶ **v1.5.x** ç‰ˆæœ¬æ¨èä½¿ç”¨çš„è¡¨å•éªŒè¯æ–¹å¼å°±æ˜¯ Vuelidateï¼ˆè¯´å•†ä¸šèƒ¡å¹å§ Vuelidate å®˜ç½‘ä¹Ÿæ²¡æä½  Vuetify å•Šï¼Œæ˜¯è¿™ä¸ªåŸå› å¯¼è‡´ Vuetify v2.0.x ç‰ˆæœ¬åˆæ¨èäº† [Vee-validate](https://logaretm.github.io/vee-validate/) ä¹ˆï¼Ÿå“ˆå“ˆå“ˆå“ˆğŸ˜„ï¼‰ã€‚

## ç”¨æ³•
### å®‰è£…
```s
$ npm install vuelidate --save
```
### å¯¼å…¥
åœ¨`main.js`ä¸­å¼•å…¥å¹¶ä½¿ç”¨ï¼š

```vue
import Vuelidate from 'vuelidate';
Vue.use(Vuelidate);
```
### åŸºç¡€ä½¿ç”¨

**1. åœ¨ç»„ä»¶ä¸­å¼•å…¥éªŒè¯è§„åˆ™**

ä½¿ç”¨æ’ä»¶æœ€æ–¹ä¾¿ä¹‹å¤„å°±åœ¨äºä¸ç”¨è‡ªå·±é€ä¸ªå»å†™æ­£åˆ™è¡¨è¾¾å¼ï¼ŒVuelidate æä¾›äº†å¾ˆå¤šå¸¸è§çš„å†…ç½®éªŒè¯è§„åˆ™ï¼š

|éªŒè¯è§„åˆ™|å‚æ•°|ä½œç”¨|
|---|---|---|
|required|æ— |éç©ºæ•°æ®éªŒè¯|
|requiredIf|flag[^1]|å½“ flag ä¸º`true`æ—¶éªŒè¯éç©º|
|requiredUnless|flag|å½“ flag ä¸º`false`æ—¶éªŒè¯éç©º|
|minLength|length|æœ€å°é•¿åº¦éªŒè¯ï¼ŒåŒ…å« length å€¼|
|maxLength|length|æœ€å¤§é•¿åº¦éªŒè¯ï¼ŒåŒ…å« length å€¼|
|minValue|value|æ•°å­—æˆ–æ—¥æœŸæœ€å°å€¼éªŒè¯|
|maxValue|value|æ•°å­—æˆ–æ—¥æœŸæœ€å¤§å€¼éªŒè¯|
|between|minValue, maxVulue|æ•°å­—æˆ–æ—¥æœŸæŒ‡å®šåŒºé—´éªŒè¯|
|alpha|æ— |ä»…æ¥å—å­—æ¯å’Œå­—ç¬¦|
|alphaNum|æ— |ä»…æ¥å—å­—æ¯å’Œæ•°å­—|
|numeric|æ— |ä»…æ¥å—æ•°å­—ï¼ˆä¸åŒ…å«è´Ÿæ•°ï¼‰|
|integer|æ— |ä»…æ¥å—æ­£è´Ÿæ•´æ•°|
|decimal|æ— |ä»…æ¥å—æ­£è´Ÿåè¿›åˆ¶æ•°|
|email|æ— |ç”µå­é‚®ç®±éªŒè¯|
|ipAddress|æ— |[IPv4åœ°å€](https://zh.wikipedia.org/wiki/IPv4)éªŒè¯|
|macAddress|åˆ†éš”ç¬¦ï¼Œå¦‚`:`ã€`' '`|[MACåœ°å€](https://zh.wikipedia.org/wiki/MAC%E5%9C%B0%E5%9D%80)éªŒè¯|
|sameAs|flag|éªŒè¯ä¸ç»™å®šå˜é‡æ˜¯å¦ç›¸ç­‰|
|url|æ— |éªŒè¯ç½‘å€|
|or|å¤šä¸ªéªŒè¯è§„åˆ™|é€šè¿‡ç»™å®šçš„è‡³å°‘ä¸€ä¸ªéªŒè¯è§„åˆ™æ—¶é€šè¿‡|
|and|å¤šä¸ªéªŒè¯è§„åˆ™|å½“é€šè¿‡æ‰€æœ‰çš„éªŒè¯è§„åˆ™æ—¶é€šè¿‡|
|not|éªŒè¯è§„åˆ™|å½“ä¸é€šè¿‡ç»™å®šçš„éªŒè¯è§„åˆ™æ—¶é€šè¿‡ï¼Œå¸¸ä¸ sameAs åˆç”¨|
è¦ä½¿ç”¨è¿™äº›å†…ç½®çš„éªŒè¯è§„åˆ™åªéœ€åœ¨ç»„ä»¶ä¸­æŒ‰éœ€å¼•å…¥ï¼š

```vue
<script>
import { required, numeric } from "vuelidate/lib/validators";
</script>
```
**2. éªŒè¯è¡¨å•**

Vuelidate æœ€ä¾¿æ·çš„éªŒè¯æ–¹å¼æ˜¯åŸºäº Vue çš„`v-model`æ•°æ®æ¥éªŒè¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒVuelidate å’Œ Vue é‡‡ç”¨çš„æ˜¯ç›¸åŒçš„ä»£ç ä¸é¡µé¢äº¤äº’æ–¹å¼â€”â€”æ•°æ®é©±åŠ¨è§†å›¾ï¼ŒVuelidate é€šè¿‡ç›‘å¬åŒå‘ç»‘å®šçš„æ•°æ®æ¥åŠ¨æ€åˆ¤æ–­å…¶æ˜¯å¦é€šè¿‡éªŒè¯è§„åˆ™ï¼Œä»è€Œå†å°†éªŒè¯é€šè¿‡ä¸å¦çš„ä¸åŒç»“æœåé¦ˆç»™ç”¨æˆ·ã€‚

**ç¬¬ä¸€æ­¥ã€åœ¨ validations ä¸­æŒ‚è½½éœ€è¦éªŒè¯çš„è¡¨å• data æ•°æ®**

```vue
export default {
  name: 'HelloWorld',
  validations: {
    zander: { required, numeric }
  },
  data() {
    return {
      zander: ''
    }
  }
}
```
**ç¬¬äºŒæ­¥ã€ç”¨ Vuelidate çš„`$model`ç®¡ç†è¡¨å•æ•°æ®**

`$model`ç›¸å½“äº`v-model`çš„æ›¿ä»£ï¼Œæ˜¯å¯¹åŸå§‹ data æ•°æ®çš„å¼•ç”¨ï¼Œåœ¨å…¶å®ƒåœ°æ–¹ä½¿ç”¨è¯¥æ•°æ®æ—¶æ— éœ€æ”¹å˜ä»€ä¹ˆï¼Œ`this.$v.data.$model`çš„å€¼ä¸`this.data`å®Œå…¨ç›¸åŒã€‚è¢«`$model`ç®¡ç†çš„æ•°æ®å«æœ‰ä¸€ä¸ª Boolean ç±»å‹çš„æ ‡å¿—`$dirty`æ¥è¡¨ç¤ºæ•°æ®æ˜¯å¦æ”¹å˜ï¼Œå¾ˆå®¹æ˜“ç†è§£â€”â€”å¦‚æœæ•°æ®æ”¹åŠ¨äº†ï¼Œé‚£å®ƒå°±æ˜¯è‚®è„çš„ğŸ¤£ï¼Œ`$dirty`ç½®ä¸º trueã€‚å½“æ¯å½“è¢«éªŒè¯çš„æ•°æ®æ”¹å˜æ—¶ Vuelidate éƒ½ä¼šéªŒè¯ä¸€æ¬¡æ•°æ®æ˜¯å¦é€šè¿‡éªŒè¯è§„åˆ™ã€‚

`$model`çš„`$touch()`æ–¹æ³•å¯ä»¥å°†`$dirty`çš„å€¼æ‰‹åŠ¨è®¾ä¸º trueï¼Œæ€ä¹ˆç”¨å‘¢ï¼Ÿå¦‚æœä½ ä¸æƒ³æŠŠ Vue ä¸­çš„`v-model="data"`æ”¹ä¸º Vuelidate çš„`v-model="$v.data.$model"`ï¼Œé‚£å°±å¯ä»¥ä¸ºè¾“å…¥æ¡†æ·»åŠ  change æ–¹æ³•ï¼Œåœ¨ change æ–¹æ³•ä¸­å†è°ƒç”¨`$touch()`æ–¹æ³•ï¼Œä¸¤ç§æ–¹å¼çš„å¤„ç†ç»“æœæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚


```vue
<input type="text" v-model="$v.zander.$model">
or 
<input type="text" v-model="zander" @change="$v.zander.$touch()">
```
> å¦‚æœè§‰å¾—..æ¯å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå­—ç¬¦..å°±éªŒè¯ä¸€æ¬¡å¤ªé¢‘ç¹ï¼Œå¯ä»¥åŠ ä¸Š`v-model`çš„[`.lazy`](https://cn.vuejs.org/v2/guide/forms.html#lazy)ä¿®é¥°ç¬¦æ¥ä½¿éªŒè¯é¢‘ç‡æ”¹ä¸º..æ¯å½“ç”¨æˆ·è¾“å…¥å®Œæˆ..åéªŒè¯ã€‚


**ç¬¬ä¸‰æ­¥ã€æ·»åŠ éªŒè¯ä¸é€šè¿‡çš„åé¦ˆ**

éªŒè¯è§„åˆ™ä¸é€šè¿‡è‡ªç„¶è¦æœ‰åé¦ˆåŠ¨ä½œæ¥æç¤ºç”¨æˆ·å“ªé‡Œå‡ºé”™äº†æˆ–åº”è¯¥è¾“å…¥ä»€ä¹ˆå†…å®¹ï¼Œå¦‚æœåœ¨æ™®é€š Vue é¡¹ç›®[^2]ä¸­ä½¿ç”¨ Vuelidateï¼Œè¦æ˜¾ç¤ºéªŒè¯ä¸é€šè¿‡çš„é”™è¯¯ä¿¡æ¯éœ€è¦è‡ªå·±æ‰‹åŠ¨æ·»åŠ åé¦ˆä¿¡æ¯çš„å®¹å™¨å’Œæ ·å¼ï¼Œæ ¹æ®éªŒè¯ç»“æœæ§åˆ¶å®¹å™¨çš„æ˜¾ç¤ºä¸éšè—å³å¯ï¼š

```vue
<input type="text" v-model="$v.zander.$model">
<div v-if="!$v.zander.required">ä¸èƒ½ä¸ºç©º</div>
<div v-if="!$v.zander.numeric">è¯·è¾“å…¥æ•°å­—</div>
```

![required&numeric.gif](/images/vuelidate:required-numeric.gif "æ²¡æœ‰æ ·å¼çš„éªŒè¯åé¦ˆ")

è€Œè‡³æ­¤ï¼Œæˆ‘æ–¹æ‰æ˜ç™½ä¸ºä»€ä¹ˆ Vuetify æ¨èä½¿ç”¨ Vuelidate äº†ï¼š

![vuetify-vuelidate.gif](/images/vuelidate:vuetify-vuelidate.gif "Vuetify ä¸­ Vuelidate çš„éªŒè¯åé¦ˆ")

é¡¹ç›®ä¸­æ¯ç±»è¡¨å•çš„éªŒè¯åé¦ˆå‡ ä¹éƒ½éœ€è¦ç»Ÿä¸€çš„æ ·å¼ã€åˆç†çš„è¿‡æ¸¡åŠ¨ç”»ï¼Œè€Œè¿™äº›ï¼ŒVuetify éƒ½æ›¿ä½ åšäº†ğŸ¥°ã€‚ç›¸å¯¹çš„ï¼Œåœ¨ Vuetify ä¸­è®¾ç½® Vuelidate åé¦ˆçš„æ–¹å¼ä¹Ÿæœ‰æ‰€ä¸åŒäº†ï¼Œä¹Ÿæ›´ç®€å•äº†ï¼Œåªéœ€è¦åœ¨ç»™è¾“å…¥æ¡†ç»‘å®šä¸€ä¸ªé”™è¯¯ä¿¡æ¯çš„å±æ€§ï¼Œç„¶åä½¿ç”¨è®¡ç®—å±æ€§åŠ¨æ€åœ°è®¾ç½®éªŒè¯åé¦ˆçš„å…·ä½“ä¿¡æ¯ï¼š

```v
<v-text-field v-model="$v.zander.$model" :error-messages="zanderErrors"></v-text-field>
...
export default {
  computed: {
    zanderErrors() {
      const errors = [];
      if (!this.$v.zander.$dirty) return errors; // éªŒè¯é€šè¿‡åˆ™è¿”å›ç©ºæ•°ç»„
      !this.$v.zander.required && errors.push("ä¸èƒ½ä¸ºç©º"); // çŸ­è·¯è¯­æ³•ï¼Œå¦‚æœéç©ºéªŒè¯ä¸é€šè¿‡åˆ™åŠ å…¥æ­¤åé¦ˆä¿¡æ¯
      !this.$v.zander.numeric && errors.push("è¯·è¾“å…¥æ•°å­—"); // çŸ­è·¯è¯­æ³•ï¼Œå¦‚æœæ•°å­—éªŒè¯ä¸é€šè¿‡åˆ™åŠ å…¥æ­¤åé¦ˆä¿¡æ¯
      return errors;
    }
  }
}
```

### è¿›é˜¶æ“ä½œ
ä¸Šé¢ä¸‰æ­¥å·²ç»åŸºæœ¬å®Œæˆäº†å¤§å¤šæ•°ç®€å•è¡¨å•éªŒè¯ï¼Œä¸‹é¢å°±å†ä»‹ç»å‡ ä¸ªæˆ‘åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ç¢°åˆ°çš„éœ€è¦æ³¨æ„çš„ç‚¹ã€‚

**1. éªŒè¯å¯¹è±¡çš„æŸä¸ªå±æ€§**

å°±åƒä¸Šæ–‡ä¸­çš„ç¬¬äºŒä¸ª GIFï¼Œæˆ‘ä»¬æœ‰æ—¶ç»™ä¸¤ä¸ªè¾“å…¥æ¡†ç»‘å®šçš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¤šä¸ªå±æ€§ï¼Œæƒ³è¦ç»™æ¯ä¸ªå±æ€§éƒ½æ·»åŠ ä¸åŒçš„éªŒè¯è§„åˆ™ï¼Œåªéœ€è¦ç»‘å®šæ—¶ä½¿ç”¨`.`è¯­æ³•è®¿é—®å¯¹è±¡çš„å±æ€§ï¼ŒæŒ‚è½½æ—¶ä½¿ç”¨åµŒå¥—çš„å½¢å¼å³å¯ï¼š

```v
<v-text-field v-model="$v.zanderObj.memo.$model" :error-messages="memoErrors"></v-text-field>
<v-text-field v-model="$v.zanderObj.amount.$model" :error-messages="amountErrors"></v-text-field>
...
export default {
  validations: {
    zanderObj: {
      memo: { required },
      amount: { required, numeric }
    }
  },
  data: () => ({
    zanderObj: {
        memo: '',
        amount: ''
    }
  })
}
```

**2. è‡ªå®šä¹‰éªŒè¯è§„åˆ™**

Vuelidate å†…ç½®éªŒè¯è§„åˆ™å›ºç„¶å¥½ç”¨ï¼Œä½†å¾€å¾€å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„å®é™…éœ€æ±‚ï¼Œæ¯”å¦‚éœ€è¦ä¸€ä¸ªè°ƒæ•´è–ªèµ„æ•°ç›®çš„éªŒè¯è§„åˆ™ï¼Œéœ€è¦éªŒè¯æ­£è´Ÿæ•´æ•°åŠæ­£è´Ÿå°æ•°ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å»è‡ªå®šä¹‰éªŒè¯è§„åˆ™ï¼ŒVuelidate æä¾›äº†å¸®åŠ©æˆ‘ä»¬è‡ªå®šä¹‰åŸºäºæ­£åˆ™è¡¨è¾¾å¼éªŒè¯è§„åˆ™çš„æ–¹æ³•`regex()`ã€‚

é¦–å…ˆéœ€è¦å¼•å…¥ Vuelidate çš„ helpers å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥ä½¿ç”¨`helpers.regex()`å‡½æ•°è‡ªå®šä¹‰ç¬¦åˆæˆ‘ä»¬è¦æ±‚çš„æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™ï¼Œå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºè¯¥éªŒè¯è§„åˆ™çš„æè¿°å’Œæ­£åˆ™è¡¨è¾¾å¼ã€‚æœ€åï¼Œåƒä½¿ç”¨å†…ç½®éªŒè¯è§„åˆ™ä¸€æ ·ç®€å•åœ°ä½¿ç”¨è‡ªå®šä¹‰è§„åˆ™å§ï¼š

```vue
import { helpers } from 'vuelidate/lib/validators';

const money = helpers.regex('plusOrMinusFloatNum', /^(\-|\+)?\d+(\.\d+)?$/);
export default {
  ...
  validations: {
      adjustSalary: { required, money }
  },
  computed: {
    amountErrors() {
      const errors = [];
      if (!this.$v.adjustSalary.$dirty) return errors;
      !this.$v.adjustSalary.money && errors.push("è¯·è¾“å…¥æ­£ç¡®çš„è°ƒæ•´æ•°ç›®");
      return errors;
    }
  }
}
```

**3. æäº¤è¡¨å•çš„éªŒè¯**

å½“ç„¶ï¼Œè¡¨å•éªŒè¯çš„ç›®çš„æ˜¯è®©å…¶æäº¤æ­£ç¡®æ ¼å¼çš„æ•°æ®ï¼Œè¿™å°±éœ€è¦åœ¨ç‚¹å‡»æäº¤æŒ‰é’®æ—¶åˆ¤æ–­æ•°æ®çš„æ­£ç¡®æ€§ï¼Œå¦‚æœä¸æ­£ç¡®åˆ™ä¸å‘åå°å‘é€è¯·æ±‚ç­‰ã€‚`$invalid`æ˜¯ç”¨äºè¡¨ç¤ºæ•°æ®æ˜¯å¦é€šè¿‡éªŒè¯çš„ Boolean ç±»å‹çŠ¶æ€å€¼ï¼Œå…¶å€¼ä¸º true æ—¶è¡¨ç¤ºéªŒè¯ä¸é€šè¿‡ï¼Œæ­¤æ¬¡æäº¤æ“ä½œæ— æ•ˆã€‚

```vue
<template>
  <div>
    <input type="text" v-model="$v.zander.$model">
    <button @click="submit">æäº¤</button>
    <div v-if="!$v.zander.required">ä¸èƒ½ä¸ºç©º</div>
    <div v-if="!$v.zander.numeric">è¯·è¾“å…¥æ•°å­—</div>
  </div>
</template>

<script>
import { required, numeric } from "vuelidate/lib/validators";

export default {
  name: "HelloWorld",
  validations: {
    zander: { required, numeric }
  },
  data() {
    return {
      zander: ""
    };
  },
  methods: {
    submit() {
      this.$v.$touch();
      if (this.$v.$invalid) {
        confirm('æ— æ•ˆæäº¤');
      }
      ...
    }
  }
};
</script>
```

![submit-invalid.gif](/images/vuelidate:submit-invalid.gif "æäº¤ä¸æˆåŠŸ")

è¿˜æœ‰ä¸€ä¸ªå¸¸ç”¨çš„æ–¹æ³•æ˜¯`$reset()`ï¼Œå®ƒçš„ä½œç”¨ä¸`$touch()`æ­£ç›¸åï¼Œå°†æ‰€æœ‰è¢«éªŒè¯æ•°æ®çš„`$dirty`æ ‡å¿—ç½®ä¸º false çŠ¶æ€ï¼Œå¸¸ç”¨äºé‡ç½®è¡¨å•æ“ä½œï¼š

```vue
...
<button @click="reset">é‡ç½®</button>

<script>
export default {
  ...
  methods: {
    reset() {
      this.data = '';
      this.$v.$reset();
    }
  }
};
</script>
```
---

Vuelidate çš„åŠŸèƒ½è¿œè¿œä¸æ­¢äºæ­¤ï¼Œè¿™é‡Œå°±åªåˆ—ä¸¾ä¸€äº›å¸¸è§çš„ç”¨æ³•å’ŒèŒƒä¾‹äº†ã€‚è¯è¯´å›æ¥ï¼Œå…¶å®é¡¹ç›®ä¸­æ•´ä½“ä½¿ç”¨ä¸‹æ¥è§‰å¾— Vuelidate ä¹Ÿæ²¡æœ‰å¤šä¹ˆç³Ÿç³•ï¼Œå…·ä½“æƒ…å¢ƒå…·ä½“è€ƒè™‘å˜›ï¼ä½†ä¸ªäººè§‰å¾—ç›¸å¯¹è€Œè¨€ [Vee-validate](https://logaretm.github.io/vee-validate/) æ›´ä¸ºè½»é‡ï¼Œä¸”éªŒè¯çš„å†™æ³•ä¹Ÿæ›´ä¸ºç®€æ´ï¼ˆStar ä¹Ÿæ›´å¤šğŸ˜Œï¼‰ã€‚å½“ç„¶ï¼Œè‡ªèº«æŠ€æœ¯å…è®¸çš„è¯ï¼Œæ’¸ä¸€ä¸ª Vue è¡¨å•éªŒè¯å·¥å…·é’ˆå¯¹æ€§åœ°ç”¨äºå…·ä½“çš„é¡¹ç›®æ˜¯æœ€å¥½ä¸è¿‡äº†ã€‚

---
[^1]: flag å¯ä»¥æ˜¯å˜é‡æˆ–å‡½æ•°ï¼Œç”¨äºåŠ¨æ€åœ°æ”¹å˜æ˜¯å¦é‡‡ç”¨æ­¤éªŒè¯è§„åˆ™ã€‚
[^2]: è¿™é‡Œçš„ã€Œæ™®é€šã€æŒ‡çš„æ˜¯æ²¡æœ‰é‡‡ç”¨ä»»ä½• UI æ¡†æ¶ï¼Œä½¿ç”¨åŸç”Ÿ HTML è¯­è¨€ç¼–å†™çš„ Vue é¡¹ç›®ã€‚